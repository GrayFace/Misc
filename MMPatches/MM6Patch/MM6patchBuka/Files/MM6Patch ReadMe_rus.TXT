GrayFace MM6 Patch v2.1
Автор: Сергей Роженко <mailto:sergroj@mail.ru>
https://grayface.github.io/ru/
Перевод части ReadMe на русский: Black Phantom <mailto:mm6789@yandex.ru>

Данный патч включает официальные патчи, Mok's patch и Angel's patch, а также добавляет много нового.

([+] - фича, [-] - исправленный баг, [*] - другое)

Изменения версии 2.1:
  << MM6 - MM8 >>
[+] Поддержка полноцветного (32-битного) режима в оконном и оконно-полноэкранном режиме. Чтобы отключить, добавьте "SupportTrueColor=0" в INI. Вы можете задать опции RenderMaxWidth и RenderMaxHeight, чтобы ограничить разрешение, на которое картинка растягивается более качествено. Скрытые опции ScalingParam1 (по умолчанию 3) и ScalingParam2 (по умолчанию 0.2) задают чёткость при растяжении интерфейса.
[+] Опция "BorderlessFullscreen" включает оконно-полноэкранный режим - вместо смены разрешения игра растягивается на полный экран, с чёрными полосами, если они нужны. Установите её в 0, чтобы отключить.
[+] Опции "WindowWidth" и "WindowHeight" устанавливают размер окна в оконном режиме. Значение -1 означает "вычислить автоматически исходя из сохранения пропорций".
[+] Видеоролики плавно растягиваются на любой размер. Чтобы отключить для старого полноэкранного режима, добавьте "SmoothMovieScaling=0" в INI, а для оконного режима добавьте "CompatibleMovieRender=0" (не рекомендуется!).
[+] Свои архивы SND и VID. Работают точно так же, как архивы LOD.
[+] Опции "TurnBasedSpeed" (для хода монстров) и "TurnBasedPartySpeed" (для хода игрока) ускоряют пошаговую битву.
[+] При переключении с режима управления мышью на обычный режим мышь помещается в центр экрана, если с момента прошлого переключения прошло более 10 секунд. Иначе она остаётся на прошлом месте. Число секунд задаётся скрытой опцией "MouseLookRememberTime".
[+] Пока нажата правая кнопка мыши, управление мышью теперь отключается, чтобы легко можно было проверить активные заклинания, текущее время, или произвести какое-то действие, нажав левую кнопку мыши, не отпуская правую. Установите MouseLookWhileRightClick=1, чтобы оставлять управление мышью включённым.
[+] Опция PlayMP3 теперь поддерживает файлы WAV в папке Music. Музыка в формате WAV исключает проблемы с зацикливанием воспроизведения.
[+] Другой подход к исправлению сундуков: теперь содержимое упорядочивается по силе и первыми в сундук кладутся более важные/сильные вещи. Установите FixChestsByReorder=0, чтобы отключить.
[+] Чёрные зелья не тратятся, если уже были выпиты.
[+] Бесконечная дальность обзора в подземельях (монстры не пропадают, если они слишком далеко).
[+] Скрытая опция "FixInfiniteScrolls" контролирует соответствующее исправление.
[-] Исправлены баги, связанные с таймерами: таймер сбрасывался, если посетить локацию до того, как его период прошёл; в MM6, в момент очередного посещения карты на поздней стадии игры, колодцы можно был использовать огромное число раз; в MM8 таймеры, не связанные с пополнением колодцев, работали не так, как в MM6 и MM7. Чтобы отключить исправление, добавьте строку "FixTimers=0" в INI.
[-] Мой баг: файлы *.evt и *.str загружались из DataFiles неверно.
[-] Монстры теперь редко спрыгивают с мостов в лаву. Высота, с которой монстры не прыгают, настраивается скрытой опцией "MonsterJumpDownLimit" (по умолчанию 500).
[-] Немного уменьшена высота прыжка, поскольку после исправления ошибок округления при движении игрок стал прыгать слишком высоко. Ещё добавлена скрытая опция "FixMovement=0", возвращающая ошибки округления для тех, кому они дороги.
[-] Бластеры и некоторые заклинания не попадали по крысам.
[-] Вылет при слишком сильном уменьшении спрайтов (происходил при использовании MM6HD).
[-] Городской портал тратил ход игрока, даже если отказаться от телепортации.
[-] Команды EVT не могли работать с неиспользованным умением Воровства.
[-] Вылет при выходе.
[*] Некоторые опции скрыты, чтобы уменьшить число мало нужных строк в mm6.ini.
  << MM6, MM7 >>
[-] Бой баг: вылет при загрузке своих архивов LOD. (не знаю, как они вообще работали!)
[-] В диалоге покупки, если ни один игрок не выбран, происходило чтение "левой" памяти.
[-] Магазины покупали бластеры.
  << MM6 >>
[+] Опция "NoIntro", как в других патчах. Это зачастую удобнее, чем добавлять "-nomovie" в командной строке ярлыка.
[+] Опция "PlayMP3" теперь поддерживает расположение музыки в папке Sounds для совместимости с версией GOG.
[+] Предметы теперь располагаются в инвентаре вертикально, как в MM7 и MM8 (добавьте PlaceItemsVertically=0 в INI, чтобы отключить).
[-] NPC "учёный" не давал +5% к опыту.
[-] Бонус от NPC +2/+3 ко всем умениям оружия не влиял на время восстановления.
[-] Бой баг: ограничение на дальность Звездопада и Потока метеоров было не точным.
[-] Мой баг: нажатие "CharScreenKey" одновременно с правой кнопкой мыши иногда приводило к вылету.
  << Исправления на картах >>
[-] Исправлены отсутствующие подсказки у входов в подземелья/дома на всех наземных локациях (кроме Райской долины, она была в порядке).
[-] Фонтан в Райской долине (outa2), когда кончился, показывал "+100 очков магии (временно)" вместо "Освежает!"
[-] Фонтаны в Блэкшире и Кригспайре имели общий флаг использования - возможно было выпить только из одного из них (один даёт +5 Интеллект и Сила духа, другой - +10 Устойчивость к Магии).
[-] Кригспайр (outb1): Одна из дверей на верхней веранде замка Кригспайр не реагировала на нажатия мыши. При входе в Высший храм Баа команда смотрела не в ту сторону.
[-] Блэкшир (outb2): Летающее дерево рядом с домом со статуэтками. При входе в Волчье логово команда смотрела не в ту сторону.
[-] Чертог лорда Огня (d04): Запертый сундук нельзя было открыть, если срабатывала ловушка. Передняя грань другого сундука не реагировала на нажатие мыши.
[-] Пещеры Драгунов (d06): Правильнее работают сундуки с квестовыми предметами. Один из квестовых предметов нельзя было получить, если срабатывала ловушка. После получения квестовых предметов сундуки становились дибликатами одного и того же сундука.
[-] Железные копи Снергла (d09): Передняя грань шкафа (событие 77) не реагировала на нажатие.
[-] Крепость Драгунов (d10): Дублированные сундуки и не открываемый шкаф исправлены Black Phantom'ом. Правильнее работает сундук с кинжалом Мордред.
[-] Имение Корлагона (d11): Правильнее работает сундук с квестовым предметом.
[-] Крепость Полководца (d16): Исправлены дублированные сундуки. Правильнее работает сундук с квестовым предметом.
[-] Лаборатория Агара (d19): Исправлены дублированные сундуки (теперь в последнем сундуке есть предметы, как и было задумано).
[-] Храм Баа (t1): Состыкована текстура пола в одном месте.
[-] Храм Луны (t5): Один из алтарей увеличивал Силу последнему персонажу только если она меньше 50, другой давал первому персонажу +2 к Удаче вместо +5. Исправлено Black Phantom'ом.
[-] Высший храм Баа (t7): Исправлены дублированные сундуки. Частично основано на исправлении от Black Phantom'а.
[-] Канализация Свободной гавани (sewer.blv): Крысы появлялись в стенах. Верхняя грань одного сундука не реагировала на нажатия. Выход дома Ричарда Харпа вёл к другому дому.
[-] Оракул Энрота (oracle.blv): Проблемы с оракульской ширмой со звйздами - она часто закрывалась вместо того, чтобы открываться.
[-] New World Computing (znwc): Одна из дверей двигала часть стены при открытии.
[-] Цирк отбирал все трофеи, когда выдавал пирамиду или бочонок вина.
[-] "Мантия Баа" давалась опять, если поговорить со Сликером Сильвертонгом повторно.

Остальные изменения:
[+] Возможность использовать несколько быстрых сохранений. (см. ниже)
[+] Настройка управления. (см. ниже)
[+] F2 Включает и выключает удвоенную скорость. Опция "DoubleSpeedKey" контролирует клавишу.
[+] Опция "PlayMP3" позволяет проигрывать файлы MP3 вместо треков с CD. (см. ниже) По умолчанию установлен 0 (отключена).
[+] Опция "MusicLoopsCount" меняет количество повторов музыки. Установите на 0, чтобы музыка крутилась бесконечно.
[+] Управление мышью. (см. ниже)
[+] Опция "ToggleCharacterScreenKey" открывает/закрывает экран персонажа. По умолчанию это кнопка '~'. Чтобы отключить, установите в 0.
[+] Опция "InventoryKey" позволяет зайти в инвентарь персонажа нажатием кнопки 'I', вместо того чтобы кликать по портрету. Чтобы отключить, установите в 0.
[+] Клавиша, задаваемая опцией "AutorunKey" (по умолчанию F3) включает и выключает автобег, как в MMORPG.
[+] Опции "TurnSpeedNormal" и TurnSpeedDouble" устанавливает скорость плавного поворота. По умолчанию стоит 100% для обычной скорости и 120% для удвоенной. Скорость поворота теперь устанавливается плавной по умолчанию.
[+] Опция "MouseWheelFly" позволяет подлетать вверх и вниз, вращая колесико мыши.
[+] Опция "AlwaysStrafe" меняет поведение стрелок влево-вправо на противоположное - при их нажатии происходит шаг в сторону, а если зажат Ctrl, то поворот. В режиме управления мышью шаги в стороны включаются автоматически (это можно отключить, поставив NormalStrafe=1).
[+] Опция "FreeTabInInventory" позволяет переключаться по при помощи клавиши "Tab" на погибших персонажей пока открыт экран персонажа. По умолчанию установлена 1 (опция активна).
[+] В подсказке к параметрам "Атака" и "Точн.п." показывается время восстановления.
[+] Возможность отключить видеоролик при смерти отряда. (опция NoDeathMovie)
[+] При правом клике по опыту показывается уровень, до которого можно тренироваться и остаток опыта до следующего. Как в MM7 и MM8.
[+] Опция "ReputationNumber" показывает численное значение репутации вместе с названием категории. По умолчанию установлена 1 (опция активна).
[+] Добавлена опция NoCD. Работает только при наличии файла "Anims\Anims2.vid". По умолчанию установлена 1 (опция активна). NoCD работает только если в директории Anims находятся оба файла с видео.
[+] Опции "HorsemanSpeakTime" и "BoatmanSpeakTime" устанавливают время, необходимое конюху и моряку, чтобы сказать "Поехали" перед тем, как начнет загружаться новая карта.
[+] При запуске в полноцветном режиме игра автоматически переходит в 16 бит в оконной моде.
[+] Свои LOD-архивы (для модов). Например, архивы Data\*.icons.lod загружаются после icons.lod, заменяя его содержимое. Так же с любым другим LOD-архивом.
[+] Полезно для моддеров: файлы, извлеченные из icons.lod (кроме картинок), также загружаются из папки "DataFiles". (см. ниже)
[+] При старте игры загружаются все файлы *.dll из папки "ExeMods" (это использует MMExtension и можете использовать Вы, чтобы добавить свой патч).
[+] Улучшенная обработка ошибок. (см. ниже)
[+] Опция "BlasterRecovery" контролирует минимальное время восстановления бластера. По умолчанию установлено 5. В игре был 0.
[+] Расширена команда переключения состояния двери. Теперь моддеры могут передавать 3 вместо 2 для переключения двери, срабатывающего и в процессе движения.
[-] Исправлены баги, связанные с динамической библиотекой MSS32.dll. Со стандартной библиотекой игра иногда не запускалась, создавая файл SHRINKER.ERR с текстом "Pager initialisation error 2 - Не удается найти указанный файл". В Mok's patch и Angel's patch игра часто зависала при входе в замки или показе видео. В данном патче используется более новая версия библиотеки MSS32.Dll.
[-] Можно было пить из фонтанов много раз, если все персонажи неактивны.
[-] Можно было атаковать врага неактивным персонажем. Это исправление можно отключить, установив FixInactivePlayersActing=0.
[-] Опция "FixDualWeaponsRecovery" исправляет подсчет времени восстановления в случае, если у персонажа есть оружие во второй руке. Носить 2 оружия до этого было не выгодно из-за того, что время восстановления как минимум удваивалось. Исправленный подсчет работает так же, как в MM7 и MM8.
[-] Теперь воспроизведение игровых звуков и музыки останавливаются, если игра не является активным окном.
[-] Опция "AlwaysRun" влияет на скорость поворота в пошаговом режиме.
[-] При использовании заклинания "Городской портал" игра теперь переходит в режим паузы.
[-] Исправлена рассинхронизация между слотами сохранения и загрузки. Теперь можно использовать самый первый слот и делать пропуски между слотами.
[-] Исправлена проблема исчезновения звука шагов.
[-] Работает на Windows XP без установки совместимости.
[-] Некоторые свитки можно было использовать бесконечно, применяя к кукле персонажа в пошаговом режиме. Это исправление можно отключить, установив FixInfiniteScrolls=0.
[-] Неактивные персонажи могли использовать свитки. Это исправление можно отключить, установив FixInfiniteScrolls=0.
[-] При использовании свитка правым кликом по портрету, цель выбиралась автоматически. Поэтому, свитки типа "Из Камня в Плоть" нельзя было использовать таким способом.
[-] Свитки раньше не ставили игру на паузу при применении к кукле персонажа. Из-за этого также можно было подбирать трупы во время выбора цели заклинания.
[-] Улучшено исправление цирка в заливе Бутлег. Например, у Black Phantom'а он не работал.
[-] У одного из шатров цирка в заливе Бутлег не было текстуры входа.
[-] Бонус "Увеличивает скорость восстановления" (у Буки был переведен "Увеличивает скорость выздоровления") теперь работает. Опция "IncreaseRecoveryRateStrength" устанавливает, насколько сильно он ускоряет персонажа. По умолчанию установлено 10%.
[-] Исправлен баг игры, который мог привести к вылету игры при старте.
[-] В пошаговой моде на ход тратилось в 2 раза больше времени, чем надо.
[-] Громкость видео не зависела от Общей Громкости, установленной в Настройках.
[-] Теперь предметы, не поместившиеся в сундук, появятся в нем при следующем открытии, если освободить место. (опция "FixChests")
[-] Отключено глючное перемещение персонажей по слотам с помощью Ctrl + клика.
[-] Теперь Звездопад и Поток метеоров не работают за границей дальности стрельбы. Это исправление можно отключить, установив FixStarburst=0.
[-] В окне генерации команды ограничена скорость анимации.
[-] Исправлены некоторые ошибки выхода за границы бока памяти.
[-] При переходе между картами буферы звуков освобождались до того, как звуки прерывались. К тому же, не все ресурсы освобождались.
[-] Автосохранение происходило после оплаты путешествия на лошадях или корабле.
[-] Магические повреждения оружий теперь не игнорируют сопротивляемости.
[-] Исправлены заклинания, лечащие состояния - они работали 3 часа/дня на единицу навыка вместо 1, а при очень больших значениях навыка происходило переполнение).
[-] Ожидание с использованием диалога отдыха не восстанавливало действия персонажей.
[-] Нажатия клавиш теоретически могли игнорироваться, если одновременно с игрой запущены другие программы, опрашивающие клавиатуру тем же способом.
[-] Диалог пересечения карты вызывался при низком полете, при согласии перемещение на другую карту не происходило.
[-] Редкий случай "отрицательное значение/0" в экране статистик приводил к вылету.
[-] Маяк Ллойда сохранял игру после вычитания маны и добавления времени восстановления.
[-] Городской портал сохранял игру после добавления времени восстановления.
[-] Городской портал сохранял игру даже при телепорте в текущую карту.
[-] Хотя баг со вспышкой Радужного Света не был замечен в MM6, его причина здесь также была исправлена.
[-] Заклинание "Перст смерти" не давало опыта за убитых им монстров.
[-] Исправлены проблемы с ошибками округления при движении. Из-за этих проблем шаги вбок были "кривоваты".
[-] На некоторых компьютерах время от времени переставало работать сохранение. На самом деле это вызвано багом какого-то системного ПО, а не самой игры.
[-] Архиву games.lod требовалась очень специфическая сортировка.
[*] В Свободной Гавани добавлена гильдия контрабандистов. Она планировалась разработчиками, но не была использована в файле карты.
[*] Используются более новые версии MSS32.dll и Smackw32.dll.

Изменения из Angel's patch <angeldeath29@mail.ru> (http://sites.google.com/site/angelddeath/#TOC-MM6-)
[-] Исправлена работа цирка в заливе Бутлег.

Изменения из Mok's patch:
[+] Опция "AlwaysRun" позволяет бежать. Если Вы нажмете клавишу Shift Вы перейдете в режим ходьбы. По умолчанию установлена 1 (активна). Эта опция всегда отключена перед установкой патча.
[+] Клавиша "Caps Lock" переключает режим бега/ходьбы, если опция "CapsLockToggleRun" имеет значение 1. По умолчанию установлена в 0 (не активна). (Эта опция управления была добавлена в GrayFace Patch)
[+] Опция "FlipOnExit" позволяет Вашему отряду разворачиваться при выходе из здания. По умолчанию установлена в 0 (не активна). Эта опция всегда включена перед установкой патча.
[+] Опция "LoudMusic" устанавливает максимальную громкость игровых CD-аудиотерков на максимум нормальной громкости воспроизведения CD Audio. Обычно в игре громкость устанавливается на половину стандартной громкости, которая является слишком тихой для некоторых конфигураций. По умолчанию установлена в 0. Эта опция всегда отключена перед установкой патча.
[-] Исправлены неработающие двери в Гильдии Тени и в замке Кригспайр.
[-] Исправлена ошибка, связанная со временем восстановления после атаки при использовании щитов и доспехов. (Благодарность Mike Kienenberger за исправление).
[-] Исправлена инициализация CD-аудиотерков. Музыка будет играть, даже если 2-ой диск игры находится не в первом устройстве CD-ROM на Вашей системе.
[-] Исправлена ошибка проверки свободного места на жестком диске.

Все опции настраиваются в файле mm6.ini. Он создается при первом запуске.
Опции, зависящие от перевода, находятся в mm6lang.ini. Чтобы поменять какую-нибудь из них, создайте опцию с таким же именем в mm6.ini, потому что mm6lang.ini перезаписывается при установке новой версии патча.

--------------------------------------------------------------------------------
Быстрые сохранения:
Нажмите F11, чтобы сохранить игру. Вы увидите сообщение "Игра сохранена!". Вы можете изменить клавишу быстрого сохранения - это опция "QuickSavesKey" в mm6.ini.
Опция "QuickSavesCount" контролирует количество быстрых сохранений.
Опция "QuickSavesName" задает имя для сохранений. По умолчанию это "Быстрое сохранение".
Опция "SpaceBeforeQuicksaveDigit" контролирует, нужен ли пробел между строкой "Быстрое сохранение" и номером сохранения.
Опция "QuickLoadKey" задает клавишу быстрой загрузки.

--------------------------------------------------------------------------------
Использование музыки в MP3:
Создайте папку "Music" в директории с игрой и скопируйте туда файлы от "2.mp3" до "16.mp3", соответствующие трекам с CD. Установите опцию "PlayMP3" в 1. В отличие от музыки с CD, громкость музыки в MP3 зависит от общей громкости звука, установленной в настройках, поэтому ставьте громкость музыки на максимум.
 
--------------------------------------------------------------------------------
Отключение стартовых видеороликов:
Для того, чтобы отключить стартовые видеоролики добавьте ключ "-nomovie" к командной строке в свойствах ярлыка игры. Это не особенность патча, а стандартная функция игры.

--------------------------------------------------------------------------------
Настройка управления:
Используйте https://sites.google.com/site/sergroj/mm/MM6Controls.rar для настройки управления.

--------------------------------------------------------------------------------
DataFiles:
Создайте папку "DataFiles" в директории с игрой. Чтобы изменить файл из icons.lod, извлеките его и положите в папку "DataFiles". Игра будет использовать его вместо файла из icons.lod и Вам не придется при каждой модификации вставлять файл в icons.lod. Это не работает с картинками, разве что с *.pcx.
Управляется опцией "DataFiles", которая установлена в 1 (включена) по умолчанию.

--------------------------------------------------------------------------------
Управление мышью:

Чтобы включить управление мышью (как в 3D action'ах), установите опцию MouseLook=1.
Управление мышью можно использовать в режиме, близком к 3D Action'ам или в режиме, близком к World of Warcraft и подобным играм.
Вот файл с моими настройками для режима 3D Action'а: http://sites.google.com/site/sergroj/mm/MM6MouseLook.rar

Чтобы включить режим, подобный MMO, установите опцию MouseLookUseAltMode=1 или нажмите Caps Lock, если вы включили опцию CapsLockToggleMouseLook=1. Также для этого режима можно установить "MouseLookTempKey" в 4 или код другой клавиши и сбросить на 0 опцию "MouseLookChangeKey".
Опция "MouseLookChangeKey" задает клавишу переключения между режимом управления мышью и обычным режимом. Клавиша по умолчанию - средняя кнопка мыши.
Опция "MouseLookTempKey" задает клавишу, которая переключает режим только на то время, пока Вы её держите.
Опции "MouseSensitivityX" и "MouseSensitivityY" управляют чувствительностью мыши по осям X и Y. Установка отрицательного значения чувствительности по Y инвертирует эту ось. Допустимы значения больше 100.
Опции "MouseSensitivityAltModeX" и "MouseSensitivityAltModeY" аналогичны, но используются в альтернативном ММО-подобном режиме.
Опция "MouseLookFly" позволяет летать вверх-вниз, просто направляя мышь.
Опция "MouseWheelFly" позволяет подлетать вверх и вниз, вращая колесико мыши. Это особенно полезно для взлёта в режиме управления мышью.

Изображение курсора для управления мышью находится в файле Data\MouseLookCursor.bmp

--------------------------------------------------------------------------------
Широкие экраны:
Это не связано с патчем, но знайте, что в программе настроек видеокарты можно отключить горизонтальное растяжение изображения. По крайней мере, для видеокарт Nvidia это настраивается в Панели управления Nvidia.

--------------------------------------------------------------------------------
В случае ошибки:
Если произошла ошибка, отправьте мне описание, как и когда она произошла. Если возможно, приложите сохранение. Если игра вылетела, отправьте еще файл ErrorLog.txt, который будет в директории с игрой.
